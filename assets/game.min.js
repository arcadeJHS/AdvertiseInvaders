!function(){var e=function(e,t){function i(e,t){switch(e){case 37:N.moveCannon="keyup"==t?"N":"L";break;case 39:N.moveCannon="keyup"==t?"N":"R";break;case 32:N.cannonFire="keyup"==t?!1:!0}}var A=function(e,t){return t||(t=document),t.querySelector(e)},s=function(){var e=(new Date).getTime()/1e3,t=parseInt(e,10);return Math.round(1e3*(e-t))/1e3+t};!function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"requestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelrequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),A=window.setTimeout(function(){t(i+n)},n);return e=i+n,A}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var r,a,o,h,d,u,p,w,m=A("#"+e),x=t,y=33,g=0,f=[new Audio("assets/audio/1.wav"),new Audio("assets/audio/2.wav"),new Audio("assets/audio/3.wav"),new Audio("assets/audio/4.wav")],v=new Audio("assets/audio/ufo.wav"),k=new Audio("assets/audio/crash.wav"),S=new Audio("assets/audio/fire.wav"),B=new Audio("assets/audio/bang.wav"),T="data:image/png;base64,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",F={alien_1:{id:"alien_1",width:32,height:32,tiles:[{x:4,y:4},{x:40,y:4}]},alien_2:{id:"alien_2",width:44,height:32,tiles:[{x:4,y:40},{x:56,y:40}]},alien_3:{id:"alien_3",width:48,height:32,tiles:[{x:4,y:76},{x:60,y:76}]},flyingSaucer:{id:"flyingSaucer",width:48,height:28,tiles:[{x:4,y:128}]},cannon:{id:"cannon",width:52,height:32,tiles:[{x:4,y:160},{x:60,y:160}]},cannonBullet:{id:"cannonBullet",width:4,height:28,tiles:[{x:4,y:200}]},alienBullet:{id:"alienBullet",width:12,height:28,tiles:[{x:12,y:200}]},alienExplosion:{id:"alienExplosion",width:52,height:28,tiles:[{x:32,y:200}]},saucerExplosion:{id:"saucerExplosion",width:52,height:28,tiles:[{x:88,y:200}]},bunkerFull:{id:"bunkerFull",width:24,height:24,tiles:[{x:4,y:232},{x:32,y:232},{x:60,y:232},{x:88,y:232}]},bunkerTopLeft:{id:"bunkerTopLeft",width:24,height:24,tiles:[{x:4,y:260},{x:32,y:260},{x:60,y:260},{x:88,y:260}]},bunkerTopRight:{id:"bunkerTopRight",width:24,height:24,tiles:[{x:4,y:288},{x:32,y:288},{x:60,y:288},{x:88,y:288}]},bunkerBottomLeft:{id:"bunkerBottomLeft",width:24,height:24,tiles:[{x:4,y:316},{x:32,y:316},{x:60,y:316},{x:88,y:316}]},bunkerBottomRight:{id:"bunkerBottomRight",width:24,height:24,tiles:[{x:4,y:344},{x:32,y:344},{x:60,y:344},{x:88,y:344}]},bunkerFullSmall:{id:"bunkerFullSmall",width:18,height:18,tiles:[{x:4,y:372},{x:22,y:372},{x:44,y:372},{x:66,y:372}]},scoreAdv:{id:"scoreAdv",width:140,height:28,tiles:[{x:4,y:400}]}},C=function(e){this.typeOf="sprite",this.sprite=e.sprite,this.tileId=0,this.x=e.x,this.y=e.y,this.scale=e.scale||1},_=function(e){this.base=new C(e);for(var t in this.base)this[t]=this.base[t];this.typeOf="ship",this.points=e.points,this.state="alive",this.collide=function(e){return"alive"==this.state&&e.y>=this.y&&e.y<=this.y+this.sprite.height&&e.x>=this.x&&e.x<=this.x+this.sprite.width},this.touchBorder=function(){if(R.alienSpeedX>0){var e=this.x+R.alienSquareWidth+5;return e>=a.width}var t=this.x-(R.alienSquareWidth-this.sprite.width)/2;return 0>=t},this.setSprite=function(e){this.sprite=e},this.setState=function(e){this.state=e}},I=function(e){this.base=new _(e);for(var t in this.base)"base"!=t&&(this[t]=this.base[t]);this.typeOf="flyingSaucerShip"},L=function(e){this.base=new C(e);for(var t in this.base)this[t]=this.base[t];this.typeOf="bullet",this.collide=function(e){return this.y+this.sprite.height>=e.y&&this.y<=e.y&&this.x+this.sprite.width>=e.x&&this.x<=e.x+e.sprite.width||"alive"==e.state&&this.y<=e.y+e.sprite.height&&this.y>=e.y&&this.x+this.sprite.width>=e.x&&this.x<=e.x+e.sprite.width}},E=function(e){this.typeOf="bunker",this.x=e.x,this.y=e.y,this.blocks=[new C({sprite:F.bunkerTopLeft,x:this.x,y:this.y}),new C({sprite:F.bunkerFull,x:this.x+F.bunkerFull.width,y:this.y}),new C({sprite:F.bunkerFull,x:this.x+2*F.bunkerFull.width,y:this.y}),new C({sprite:F.bunkerTopRight,x:this.x+3*F.bunkerFull.width,y:this.y}),new C({sprite:F.bunkerFull,x:this.x,y:this.y+F.bunkerFull.height}),new C({sprite:F.bunkerBottomRight,x:this.x+F.bunkerFull.width,y:this.y+F.bunkerFull.height}),new C({sprite:F.bunkerBottomLeft,x:this.x+2*F.bunkerFull.width,y:this.y+F.bunkerFull.height}),new C({sprite:F.bunkerFull,x:this.x+3*F.bunkerFull.width,y:this.y+F.bunkerFull.height}),new C({sprite:F.bunkerFull,x:this.x,y:this.y+2*F.bunkerFull.height}),new C({sprite:F.bunkerFull,x:this.x+3*F.bunkerFull.width,y:this.y+2*F.bunkerFull.height})]},D=function(e){this.typeOf="ADV",this.x=e.x,this.y=e.y,this.scale=1,this.letter=e.letter,this.blocks=[];var t=0,i=0,A=0;for(i=0,l=this.letter.length;l>i;i++)for(t=this.letter[i],A=0,n=t.length;n>A;A++)0==parseInt(t[A])&&this.blocks.push(new C({sprite:F.bunkerFullSmall,x:this.x+A*F.bunkerFullSmall.width,y:this.y+i*F.bunkerFullSmall.height}))},Y={stars:[],starsLayer:2,k_star_number:10,init:function(){if(!("ontouchstart"in window)){this.stars=[];var e,t;for(e=0;e<this.starsLayer;e++)for(this.stars.push([]),t=0;t<this.k_star_number;t++)this.stars[e].push([Math.random()*a.width,Math.random()*a.height,Math.random()*(2*e+3),Math.random()/2,2*e+3,2*e+3-2])}},drawStars:function(){var e,t,i,n,A,s,r,l,h;for(l=0,nl=this.stars.length;nl>l;l++)for(h=0,il=this.stars[l].length;il>h;h++)e=this.stars[l][h],t=e[0],i=e[1],n=e[2],A=e[3],s=e[4],r=e[5],o.fillStyle="rgba(255, 255, 255, "+A+")",o.beginPath(),o.arc(t,i,n,0,2*Math.PI,!0),o.closePath(),o.fill(),0>t-n?(e[0]=a.width-n,e[2]=Math.random()*s,e[1]=Math.random()*a.height,e[3]=Math.random()/2):e[0]-=r}},R={flyingSaucer:null,alienBullet:null,flyingSaucerTimer:null,arrAliens:null,alienBorderCollision:null,alienBulletSpeed:10,nAlienRows:5,nAliensByRow:11,alienSquareWidth:60,alienSquareHeight:40,alienSpeedX:10,alienSpeedY:40,alienInitialY:180,flyingSaucerInitialY:120,flyingSaucerSpeed:4,init:function(){this.alienBorderCollision=!0,this.flyingSaucer=null,this.flyingSaucerTimer=(new Date).getTime(),this.alienBullet=null,this.arrAliens=[],this.alienSpeedX=10;for(var e,t,i=0;i<this.nAlienRows;i++){0==i&&(e=F.alien_1,t=30),i>0&&3>i&&(e=F.alien_2,t=20),i>2&&5>i&&(e=F.alien_3,t=10);for(var n=0;n<this.nAliensByRow;n++)this.arrAliens.push(new _({sprite:e,x:n*this.alienSquareWidth+(this.alienSquareWidth-e.width)/2,y:i*this.alienSquareHeight+this.alienInitialY,points:t}))}},updateAliens:function(){g++,g>3&&(g=0),f[g].play();for(var e,t={x:0,y:0,tile:1},i=this.alienSpeedX,n=0,A=0;A<this.arrAliens.length;A++)if(e=this.arrAliens[A],"striked"!=e.state){if(e.touchBorder()&&!this.alienBorderCollision){this.alienBorderCollision=!this.alienBorderCollision,i=0,n=this.alienSpeedY,this.alienSpeedX*=-1;break}e.y+e.sprite.height>=N.cannon.y&&(d=!0)}else this.arrAliens.splice(A,1),A=0;return 0!=i&&(this.alienBorderCollision=!this.alienBorderCollision),t.x=i,t.y=n,t},drawAlienShips:function(e){for(var t,i=0;i<this.arrAliens.length;i++)t=this.arrAliens[i],"striked"==t.state&&t.setSprite(F.alienExplosion),t.x+=e.x,t.y+=e.y,t.tileId+=e.tile,t.tileId>=t.sprite.tiles.length&&(t.tileId=0),o.drawImage(r,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width,t.sprite.height);0==this.arrAliens.length&&(y=Math.floor(.8*y),R.init())},updateFlyingSaucer:function(){return this.flyingSaucer&&"striked"==this.flyingSaucer.state},drawFlyingSaucer:function(e){var t=(new Date).getTime();this.flyingSaucer?("striked"==this.flyingSaucer.state&&(this.flyingSaucer.sprite=F.saucerExplosion),this.flyingSaucer.x<=-F.flyingSaucer.width||e?(this.flyingSaucer=null,this.flyingSaucerTimer=t):(v.play(),this.flyingSaucer.x-=this.flyingSaucerSpeed,o.drawImage(r,this.flyingSaucer.sprite.tiles[0].x,this.flyingSaucer.sprite.tiles[0].y,this.flyingSaucer.sprite.width,this.flyingSaucer.sprite.height,this.flyingSaucer.x,this.flyingSaucer.y,this.flyingSaucer.sprite.width,this.flyingSaucer.sprite.height))):t-this.flyingSaucerTimer>=1e4&&(this.flyingSaucer=new I({sprite:F.flyingSaucer,x:a.width,y:this.flyingSaucerInitialY,points:100}))},drawAliens:function(){var e,t={x:0,y:0,tile:0};h==y?(t=this.updateAliens(),e=this.updateFlyingSaucer(),h=0):h++,this.drawAlienShips(t),this.drawFlyingSaucer(e)},drawAlienBullet:function(){if(this.alienBullet){var e=!0;if(this.alienBullet.y+=this.alienBulletSpeed,this.alienBullet.y>=a.height&&(e=!1),e&&!p&&this.alienBullet.collide(N.cannon)&&(p=!0,w=s(),k.play(),q.nLives--,0==q.nLives&&N.cannon.tileId++,e=!1),e)for(var t,i,n=0,A=O.arrBunker.length;A>n;n++){t=O.arrBunker[n];for(var l=0,h=t.blocks.length;h>l;l++)if(i=t.blocks[l],this.alienBullet.collide(i)){i.tileId++,i.tileId>=i.sprite.tiles.length&&t.blocks.splice(l,1),e=!1;break}}if(e&&this.alienBullet.y+this.alienBullet.sprite.height>=q.lineY){var c=q.lineInterrupts.join();c.indexOf(this.alienBullet.x.toString())<0&&q.lineInterrupts.push(this.alienBullet.x)}e?o.drawImage(r,this.alienBullet.sprite.tiles[0].x,this.alienBullet.sprite.tiles[0].y,this.alienBullet.sprite.width,this.alienBullet.sprite.height,this.alienBullet.x,this.alienBullet.y,this.alienBullet.sprite.width,this.alienBullet.sprite.height):this.alienBullet=null}else{var d=Math.floor((this.arrAliens.length+1)*Math.random());this.arrAliens[d]&&(this.alienBullet=new L({sprite:F.alienBullet,x:this.arrAliens[d].x+this.arrAliens[d].sprite.width/2,y:this.arrAliens[d].y}))}}},N={cannon:null,cannonBullet:null,moveCannon:null,cannonFire:null,cannonSpeed:8,cannonBulletSpeed:10,score:0,init:function(){this.moveCannon="N",this.cannonFire=!1,this.cannonBullet=null,this.score=0,this.cannon=new _({sprite:F.cannon,x:a.width/2-F.cannon.width/2,y:a.height-55-F.cannon.height})},updateScore:function(e){this.score+=e},drawCannon:function(){if(!d)switch(this.moveCannon){case"L":this.cannon.x>=0&&(this.cannon.x+=-this.cannonSpeed);break;case"R":this.cannon.x<=a.width-this.cannon.sprite.width&&(this.cannon.x+=this.cannonSpeed);break;default:this.cannon.x+=0}this.cannon.y=a.height-55-F.cannon.height,d||p?(o.drawImage(r,this.cannon.sprite.tiles[1].x,this.cannon.sprite.tiles[1].y,this.cannon.sprite.width,this.cannon.sprite.height,this.cannon.x,this.cannon.y,this.cannon.sprite.width,this.cannon.sprite.height),p&&!d&&s()-w>1&&(p=!1)):o.drawImage(r,this.cannon.sprite.tiles[0].x,this.cannon.sprite.tiles[0].y,this.cannon.sprite.width,this.cannon.sprite.height,this.cannon.x,this.cannon.y,this.cannon.sprite.width,this.cannon.sprite.height)},drawCannonBullet:function(){if(this.cannonBullet){var e=!0;if(this.cannonBullet.y-=this.cannonBulletSpeed,this.cannonBullet.y<=0&&(e=!1),e&&R.alienBullet&&this.cannonBullet.collide(R.alienBullet)&&(R.alienBullet=null,e=!1),e&&R.flyingSaucer&&this.cannonBullet.collide(R.flyingSaucer)&&(B.play(),R.flyingSaucer.setState("striked"),this.updateScore(R.flyingSaucer.points),e=!1),e)for(var t,i=0;i<R.arrAliens.length;i++)if(t=R.arrAliens[i],this.cannonBullet.collide(t)){B.play(),t.setState("striked"),this.updateScore(t.points),e=!1;break}if(e)for(var n,A,i=0,s=O.arrBunker.length;s>i;i++){n=O.arrBunker[i];for(var a=0,l=n.blocks.length;l>a;a++)if(A=n.blocks[a],this.cannonBullet.collide(A)){A.tileId++,A.tileId>=A.sprite.tiles.length&&n.blocks.splice(a,1),e=!1;break}}if(e)for(var n,A,i=0,s=M.arrAdv.length;s>i;i++){n=M.arrAdv[i];for(var a=0,l=n.blocks.length;l>a;a++)if(A=n.blocks[a],this.cannonBullet.collide(A)){A.tileId++,A.tileId>=A.sprite.tiles.length&&n.blocks.splice(a,1),e=!1;break}}e?o.drawImage(r,this.cannonBullet.sprite.tiles[0].x,this.cannonBullet.sprite.tiles[0].y,this.cannonBullet.sprite.width,this.cannonBullet.sprite.height,this.cannonBullet.x,this.cannonBullet.y,this.cannonBullet.sprite.width,this.cannonBullet.sprite.height):this.cannonBullet=null}else this.cannonFire&&(d||p||(S.play(),this.cannonBullet=new L({sprite:F.cannonBullet,x:this.cannon.x+this.cannon.sprite.width/2-F.cannonBullet.width/2,y:this.cannon.y})))}},M={arrAdv:[],distance:0,advFrameCounter:0,adv_letters:[[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1],[1,0,0,0,1,1,1],[1,1,0,1,1,1,1],[1,1,0,1,1,1,1],[1,1,0,1,1,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,1,1,1,1,1],[1,0,0,0,0,1,1],[1,0,1,1,1,1,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],[[0,0,0,0,0,0,0],[0,1,0,0,0,1,0],[0,1,1,0,0,1,0],[0,1,0,1,0,1,0],[0,1,0,0,1,1,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]]],moveX:15,moveY:5,marginTop:-126,updateAdvFrameCounter:21,shakeAdv:150,init:function(){var e,t,i=this.adv_letters.length;this.arrAdv=[],this.moveX=15,this.moveY=5,this.advFrameCounter=0,this.updateAdvFrameCounter=21,M.shakeAdv=150;for(var n=0;i>n;n++)e=a.width/2-(1*F.bunkerFullSmall.width*7*i+this.distance*i)/2+n*(1*F.bunkerFullSmall.width*7+this.distance),t=M.marginTop,this.arrAdv.push(new D({x:e,y:t,letter:this.adv_letters[n]}))},updateAdv:function(){for(var e,t,i,n,A=0;A<this.arrAdv.length;A++)for(e=this.arrAdv[A],e.y<40?e.y+=M.moveY:(M.moveY=0,M.updateAdvFrameCounter=5,0==M.shakeAdv--&&(M.moveX=0,M.updateAdvFrameCounter=33,k.play())),i=0,n=e.blocks.length;n>i;i++)t=e.blocks[i],t.x+=M.moveX,t.y+=M.moveY;M.moveX*=-1},drawAdv:function(){var e,t,i,n,A;for(n=0,b=this.arrAdv.length;b>n;n++)for(e=this.arrAdv[n],A=0,i=e.blocks.length;i>A;A++)t=e.blocks[A],o.drawImage(r,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width*e.scale,t.sprite.height*e.scale)},advLoop:function(){M.advFrameCounter==M.updateAdvFrameCounter?(M.updateAdv(),M.advFrameCounter=0):M.advFrameCounter++,this.drawAdv()}},O={arrBunker:[],nBunkers:4,init:function(){var e,t;this.arrBunker=[];for(var i=0;i<this.nBunkers;i++)e=a.width/(2*this.nBunkers)-4*F.bunkerFull.width/2+i*(a.width/this.nBunkers),t=a.height-180,this.arrBunker.push(new E({x:e,y:t}))},drawBunkers:function(){for(var e,t,i=0,n=this.arrBunker.length;n>i;i++){e=this.arrBunker[i];for(var A=0,s=e.blocks.length;s>A;A++)t=e.blocks[A],o.drawImage(r,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width,t.sprite.height)}}},q={nLives:3,lineY:0,lineHeight:5,lineInterrupts:[],lineImageData:null,init:function(){this.nLives=3,this.lineInterrupts=[],this.lineImageData=null,this.lineY=a.height-50;new z.textArea({cls:"field livesField",childs:[z.writeText({cls:"text livesText",id:"livesPlayer1",text:this.nLives})],appendTo:m,left:"0px",bottom:"0px"})},sortInterrupts:function(e,t){return e-t},drawLine:function(){o.fillStyle="rgba(0,255,0,255)";var e=0,t=a.width;q.lineInterrupts.sort(this.sortInterrupts);for(var i=0;i<this.lineInterrupts.length;i++)t=this.lineInterrupts[i]-e,o.fillRect(e,this.lineY,t,this.lineHeight),e=this.lineInterrupts[i]+F.alienBullet.width;t=a.width-e,o.fillRect(e,this.lineY,t,this.lineHeight)},drawLives:function(){this.drawLine();for(var e,t,i=0;i<this.nLives;i++)t=a.height-F.cannon.height-7,e=F.cannon.width+1.5*i*F.cannon.width,c=new _({sprite:F.cannon,x:a.width/2-F.cannon.width/2,y:a.height-F.cannon.height}),o.drawImage(r,F.cannon.tiles[0].x,F.cannon.tiles[0].y,F.cannon.width,F.cannon.height,e,t,F.cannon.width,F.cannon.height);d||z.updateText("#livesPlayer1",this.nLives)}},z={textArea:function(e){if(this.div=document.createElement("div"),e.id&&(this.div.id=e.id),this.div.className=e.cls,this.childs=e.childs,this.appendTo=e.appendTo,e.width&&(this.div.style.width=e.width+"px"),this.appendTo.appendChild(this.div),this.childs)for(var t=0,i=this.childs.length;i>t;t++)this.div.appendChild(this.childs[t]);return this.set=function(e){var t,i,n,A;if(e.position)switch(e.position){case"centerBottom":t=a.width/2-this.div.offsetWidth/2+"px",A="0px";break;case"centerHV":t=a.width/2-this.div.offsetWidth/2+"px",i=a.height/2-this.div.offsetHeight/2+"px";break;case"centerH":t=a.width/2-this.div.offsetWidth/2+"px"}e.left&&(t=e.left),e.top&&(i=e.top),e.bottom&&(A=e.bottom),e.right&&(n=e.right),this.div.style.left=t,this.div.style.top=i,this.div.style.bottom=A,this.div.style.right=n},this.set(e),this},removeTextArea:function(e){m.removeChild(document.querySelector("#"+e))},writeText:function(e){var t=document.createElement("p");return t.className=e.cls,e.id&&(t.id=e.id),e.text&&t.appendChild(document.createTextNode(e.text)),e.innerhtml&&(t.innerHTML=e.innerhtml),e.onclick&&(t.onclick=e.onclick),t},writeAnything:function(e){if(!e.type)return!1;var t=document.createElement(e.type);if(e.cls&&(t.className=e.cls),e.attributes&&e.attributes.length)for(var i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i][0],e.attributes[i][1]);return e.id&&(t.id=e.id),e.text&&t.appendChild(document.createTextNode(e.text)),e.innerhtml&&(t.innerHTML=e.innerhtml),e.onclick&&(t.onclick=e.onclick),t},typewrite:function(e){for(var t,i,n=2,A=document.querySelectorAll(e),s=0;s<A.length;s++){t=A[s],t.className+=" typewrite ",i=t.textContent.length;var r=document.documentElement.appendChild(document.createElement("style")),a=t.id+"_typing {from {width: 0} to {width: "+i+"em}}";CSSRule.WEBKIT_KEYFRAMES_RULE?r.sheet.insertRule("@-webkit-keyframes "+a,0):CSSRule.MOZ_KEYFRAMES_RULE?r.sheet.insertRule("@-moz-keyframes "+a,0):CSSRule.KEYFRAMES_RULE&&r.sheet.insertRule("@keyframes "+a,0),a="{width: auto;}",r.sheet.insertRule("#"+t.id+".end"+a,0),t.style.animation=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.style["-webkit-animation"]=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.style.MozAnimation=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.style["-ms-animation"]=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.className+=" startTypewrite ",t.removeEventListener("animationend",this.typewrite_cb,!1),t.removeEventListener("webkitAnimationEnd",this.typewrite_cb,!1),t.addEventListener("animationend",this.typewrite_cb,!1),t.addEventListener("webkitAnimationEnd",this.typewrite_cb,!1)}return n*A.length},typewrite_cb:function(e){e.target.className+=" end "},changeTextColor:function(e,t){var i,n=A(e);if(!t){var s="0123456789ABCDEF";for(t="#",i=0;3>i;i++)t+=s.substr(Math.random()*s.length,1)}n&&(n.style.color=t)},updateText:function(e,t,i){var n=A(e);n.innerHTML=null==i?t:z.pad(t,5,"0","L")},removeText:function(e){var t=A("#"+e);console.debug(t),t&&t.parentNode.removeChild(t)},pad:function(e,t,i,n){var A="";for(e=e.toString();A.length<t-e.length;)A+=i;switch(n){case"L":e=A+e;break;case"R":e+=A}return e}},G=function(e){e||(e=window.event),i(e.keyCode,e.type)},W=function(){o.clearRect(0,0,a.width,a.height),Y.drawStars(),N.drawCannon(),M.advLoop(),R.drawAliens(),O.drawBunkers(),N.drawCannonBullet(),R.drawAlienBullet(),z.updateText("#scorePlayer1",N.score,!0),q.drawLives(),d&&et.gameOver(),0==q.nLives&&(d=!0)},H=function(){a=document.createElement("canvas"),a.tabIndex=0,o=a.getContext("2d"),m.appendChild(a)},P=function(){a.width=m.offsetWidth,a.height=m.offsetHeight,o.fillRect(0,0,a.width,a.height)},X=function(e){if(!e)var e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),et.game()},j=function(e){if(!e)var e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();var t=A("#nameInput").value,i="",n=N.score;qwest.post("assets/php/si_call.php",{action:"saveScore",name:t,email:i,score:n}).success(function(){et.scoreSubmitted()}).error(function(e){alert("Error: "+e)})},Q={init:function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),A=document.createElement("div"),s=document.createElement("div");mobile_shot_right=document.createElement("div"),mobile_shot_right_txt=document.createElement("div"),m.appendChild(e),m.appendChild(t),m.appendChild(i),m.appendChild(n),m.appendChild(A),m.appendChild(s),m.appendChild(mobile_shot_right),m.appendChild(mobile_shot_right_txt),e.className="mobile-button mobile-left",t.className="mobile-button mobile-left mobile-text",t.id="move-left",t.appendChild(document.createTextNode("<")),i.className="mobile-button mobile-right",n.className="mobile-button mobile-right mobile-text",n.id="move-right",n.appendChild(document.createTextNode(">")),A.className="mobile-button mobile-shot-left",s.className="mobile-button mobile-text mobile-shot-text-left",s.id="shot-L",s.appendChild(document.createTextNode("shot")),mobile_shot_right.className="mobile-button mobile-shot-right",mobile_shot_right_txt.className="mobile-button mobile-text mobile-shot-text-right",mobile_shot_right_txt.id="shot-R",mobile_shot_right_txt.appendChild(document.createTextNode("shot")),window.removeEventListener("touchstart",Q.startTouch,!0),window.removeEventListener("touchend",Q.stopTouch,!0),window.addEventListener("touchstart",Q.startTouch,!0),window.addEventListener("touchend",Q.stopTouch,!0)},startTouch:function(e){e||(e=window.event);var t=e.target.id;"right"==t||"move-right"==t?N.moveCannon="R":"left"==t||"move-left"==t?N.moveCannon="L":("fire"==t||"shot-L"==t||"shot-R"==t)&&(N.cannonFire=!0)},stopTouch:function(){N.moveCannon="N",N.cannonFire=!1}},K=function(){$(),r=new Image,r.onload=function(){H(),P(),h=0,d=!1,Y.init(),q.init(),N.init(),R.init(),O.init(),M.init();var e=(new z.textArea({cls:"field scoreField",childs:[z.writeText({innerhtml:'<span class="text scoreText">score</span> <span class="text scoreText" id="scorePlayer1">00000</span>'})],appendTo:m,left:"0px",top:"0px"}),m);"ontouchstart"in window&&Q.init(),function t(){W(),u=requestAnimationFrame(t,e)}()},r.src=T},V=function(){$(),H(),P(),Y.init();var e=x?"best score: "+x.name+" - "+x.score:"",t=new z.textArea({cls:"field",childs:[z.writeText({id:"play",cls:"text clickText menuText",innerhtml:"play",onclick:X}),z.writeText({id:"AdvInvadersText",cls:"text",text:"space invaders"}),z.writeText({id:"bestScore",cls:"text clickText bestScore",text:e})],appendTo:m,width:a.width,position:"centerH",top:"20%"});t=new z.textArea({cls:"field scoreAdvanceTableField",childs:[z.writeText({cls:"text scoreAdvanceText",text:"*score advance table*"}),z.writeText({innerhtml:"<ul id='scoreAdvanceTable'><li><span><span id='span_score_adv'></span></span><p id='score_adv' class='text scoreAdvanceText'>= ? mystery</p></li><li class='li-right'><span><span id='span_score_mystery'></span></span><p id='score_mystery' class='text scoreAdvanceText'>= ? mystery</p></li><li class='li-right'><span><span id='span_score_30'></span></span><p id='score_30' class='text scoreAdvanceText'>= 30 points</p></li><li class='li-right'><span><span id='span_score_20'></span></span><p id='score_20' class='text scoreAdvanceText'>= 20 points</p></li><li class='li-right'><span><span id='span_score_10'></span></span><p id='score_10' class='text scoreAdvanceText'>= 10 points</p></li></ul>"})],appendTo:m,width:450,position:"centerH",top:"50%"}),t=new z.textArea({cls:"field",childs:[z.writeText({id:"instructionsLink",cls:"text clickText smallText",text:"instructions",onclick:et.instructions})],appendTo:m,width:400,position:"centerBottom"}),A("#span_score_adv").style.background="url('"+T+"') -4px -396px no-repeat",A("#span_score_mystery").style.background="url('"+T+"') -4px -122px no-repeat",A("#span_score_30").style.background="url('"+T+"') -4px -4px no-repeat",A("#span_score_20").style.background="url('"+T+"') -4px -40px no-repeat",A("#span_score_10").style.background="url('"+T+"') -4px -76px no-repeat";var i=(z.typewrite("#score_adv, #score_10, #score_20, #score_30, #score_mystery"),m);!function n(){o.clearRect(0,0,a.width,a.height),Y.drawStars(),z.changeTextColor("#play"),u=requestAnimationFrame(n,i)}()},Z=function(){new z.textArea({id:"divInstructions",cls:"field instructionsFieldFrame",childs:[z.writeText({cls:"text instructionsText",innerhtml:"<ol><li>press 'play' to start</li><li>left/right keys to move</li><li>'spacebar' to shot</li></ol>"}),z.writeText({cls:"text clickText menuText",text:"close",onclick:function(){z.removeTextArea("divInstructions")}})],appendTo:m,position:"centerHV"})},J=function(){new z.textArea({id:"divScoreSubmitted",cls:"field submittedFieldFrame",childs:[z.writeText({cls:"text submittedText",text:"Score saved!"}),z.writeText({cls:"text clickText menuText",text:"close",onclick:function(){z.removeTextArea("divScoreSubmitted"),z.removeText("nameLabel"),z.removeText("nameInput"),z.removeText("scoreSubmitButton")}})],appendTo:m,position:"centerHV"})},U=function(){if(!A("#divGameOver")){var e=[z.writeText({id:"gameOver",cls:"text menuHeaderText",text:"game over"}),z.writeText({id:"playAgain",cls:"text clickText menuText",text:"play again",onclick:X})];x&&N.score>x.score&&(e.push(z.writeAnything({type:"span",id:"nameLabel",cls:"labelSpan",innerhtml:"Name: "})),e.push(z.writeAnything({type:"input",id:"nameInput",cls:"inputBox",attributes:[["type","text"]]})),e.push(z.writeText({id:"scoreSubmitButton",cls:"text clickText menuText",text:"save your score",onclick:j}))),e.push(z.writeText({id:"tweetScore",cls:"text clickText",innerhtml:"<a target='blank' href='https://twitter.com/intent/tweet?original_referer=http://matteopiazza.org&text=Play%20Advertise%20Invaders%20on%20matteopiazza.org!%20My%20score:%20"+N.score+"!&tw_p=tweetbutton'>tweet your score</a>"}));{new z.textArea({id:"divGameOver",cls:"field menuFieldFrame",childs:e,appendTo:m,position:"centerHV"})}}},$=function(){for(;m.hasChildNodes();)m.removeChild(m.lastChild)},et={intro:function(){cancelAnimationFrame(u),V()},instructions:function(){Z()},game:function(){cancelAnimationFrame(u),K()},gameOver:function(){cancelAnimationFrame(u),U()},scoreSubmitted:function(){J()}},tt=function(){et.intro()};window.addEventListener("keydown",function(e){e||(e=window.event),[32].indexOf(e.keyCode)>-1&&e.preventDefault()},!1),window.removeEventListener("keydown",G,!0),window.removeEventListener("keyup",G,!0),window.removeEventListener("resize",P,!0),window.addEventListener("keydown",G,!0),window.addEventListener("keyup",G,!0),window.addEventListener("resize",P,!0);var it=new WebSocket("ws://localhost:8000");it.addEventListener("open",function(){it.addEventListener("message",function(e){var t=JSON.parse(e.data);i(t.code,t.type)})}),tt()};window.WIinit=function(){var t=null;qwest.post("assets/php/si_call.php",{action:"getScore"}).success(function(e){e.data&&e.data.length>0&&(t=e.data[0])}).error(function(e){alert("Error retrieving best score: "+e)}).complete(function(){e("game",t)})}}();