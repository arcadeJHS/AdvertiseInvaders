!function(){var e=function(e,t){function i(e){A(W[e.command],"key"+e.type)}function A(e,t){switch(e){case W.left:N.moveCannon="keyup"==t?"N":"L";break;case W.right:N.moveCannon="keyup"==t?"N":"R";break;case W.fire:N.cannonFire="keyup"==t?!1:!0}}var s=function(e,t){return t||(t=document),t.querySelector(e)},r=function(){var e=(new Date).getTime()/1e3,t=parseInt(e,10);return Math.round(1e3*(e-t))/1e3+t};!function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"requestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelrequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),A=window.setTimeout(function(){t(i+n)},n);return e=i+n,A}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var a,o,h,d,u,p,w,m,x=s("#"+e),y=t,g=33,f=0,v=[new Audio("assets/audio/1.wav"),new Audio("assets/audio/2.wav"),new Audio("assets/audio/3.wav"),new Audio("assets/audio/4.wav")],k=new Audio("assets/audio/ufo.wav"),S=new Audio("assets/audio/crash.wav"),B=new Audio("assets/audio/fire.wav"),T=new Audio("assets/audio/bang.wav"),F="data:image/png;base64,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",C={alien_1:{id:"alien_1",width:32,height:32,tiles:[{x:4,y:4},{x:40,y:4}]},alien_2:{id:"alien_2",width:44,height:32,tiles:[{x:4,y:40},{x:56,y:40}]},alien_3:{id:"alien_3",width:48,height:32,tiles:[{x:4,y:76},{x:60,y:76}]},flyingSaucer:{id:"flyingSaucer",width:48,height:28,tiles:[{x:4,y:128}]},cannon:{id:"cannon",width:52,height:32,tiles:[{x:4,y:160},{x:60,y:160}]},cannonBullet:{id:"cannonBullet",width:4,height:28,tiles:[{x:4,y:200}]},alienBullet:{id:"alienBullet",width:12,height:28,tiles:[{x:12,y:200}]},alienExplosion:{id:"alienExplosion",width:52,height:28,tiles:[{x:32,y:200}]},saucerExplosion:{id:"saucerExplosion",width:52,height:28,tiles:[{x:88,y:200}]},bunkerFull:{id:"bunkerFull",width:24,height:24,tiles:[{x:4,y:232},{x:32,y:232},{x:60,y:232},{x:88,y:232}]},bunkerTopLeft:{id:"bunkerTopLeft",width:24,height:24,tiles:[{x:4,y:260},{x:32,y:260},{x:60,y:260},{x:88,y:260}]},bunkerTopRight:{id:"bunkerTopRight",width:24,height:24,tiles:[{x:4,y:288},{x:32,y:288},{x:60,y:288},{x:88,y:288}]},bunkerBottomLeft:{id:"bunkerBottomLeft",width:24,height:24,tiles:[{x:4,y:316},{x:32,y:316},{x:60,y:316},{x:88,y:316}]},bunkerBottomRight:{id:"bunkerBottomRight",width:24,height:24,tiles:[{x:4,y:344},{x:32,y:344},{x:60,y:344},{x:88,y:344}]},bunkerFullSmall:{id:"bunkerFullSmall",width:18,height:18,tiles:[{x:4,y:372},{x:22,y:372},{x:44,y:372},{x:66,y:372}]},scoreAdv:{id:"scoreAdv",width:140,height:28,tiles:[{x:4,y:400}]}},_=function(e){this.typeOf="sprite",this.sprite=e.sprite,this.tileId=0,this.x=e.x,this.y=e.y,this.scale=e.scale||1},I=function(e){this.base=new _(e);for(var t in this.base)this[t]=this.base[t];this.typeOf="ship",this.points=e.points,this.state="alive",this.collide=function(e){return"alive"==this.state&&e.y>=this.y&&e.y<=this.y+this.sprite.height&&e.x>=this.x&&e.x<=this.x+this.sprite.width},this.touchBorder=function(){if(M.alienSpeedX>0){var e=this.x+M.alienSquareWidth+5;return e>=o.width}var t=this.x-(M.alienSquareWidth-this.sprite.width)/2;return 0>=t},this.setSprite=function(e){this.sprite=e},this.setState=function(e){this.state=e}},L=function(e){this.base=new I(e);for(var t in this.base)"base"!=t&&(this[t]=this.base[t]);this.typeOf="flyingSaucerShip"},E=function(e){this.base=new _(e);for(var t in this.base)this[t]=this.base[t];this.typeOf="bullet",this.collide=function(e){return this.y+this.sprite.height>=e.y&&this.y<=e.y&&this.x+this.sprite.width>=e.x&&this.x<=e.x+e.sprite.width||"alive"==e.state&&this.y<=e.y+e.sprite.height&&this.y>=e.y&&this.x+this.sprite.width>=e.x&&this.x<=e.x+e.sprite.width}},D=function(e){this.typeOf="bunker",this.x=e.x,this.y=e.y,this.blocks=[new _({sprite:C.bunkerTopLeft,x:this.x,y:this.y}),new _({sprite:C.bunkerFull,x:this.x+C.bunkerFull.width,y:this.y}),new _({sprite:C.bunkerFull,x:this.x+2*C.bunkerFull.width,y:this.y}),new _({sprite:C.bunkerTopRight,x:this.x+3*C.bunkerFull.width,y:this.y}),new _({sprite:C.bunkerFull,x:this.x,y:this.y+C.bunkerFull.height}),new _({sprite:C.bunkerBottomRight,x:this.x+C.bunkerFull.width,y:this.y+C.bunkerFull.height}),new _({sprite:C.bunkerBottomLeft,x:this.x+2*C.bunkerFull.width,y:this.y+C.bunkerFull.height}),new _({sprite:C.bunkerFull,x:this.x+3*C.bunkerFull.width,y:this.y+C.bunkerFull.height}),new _({sprite:C.bunkerFull,x:this.x,y:this.y+2*C.bunkerFull.height}),new _({sprite:C.bunkerFull,x:this.x+3*C.bunkerFull.width,y:this.y+2*C.bunkerFull.height})]},Y=function(e){this.typeOf="ADV",this.x=e.x,this.y=e.y,this.scale=1,this.letter=e.letter,this.blocks=[];var t=0,i=0,A=0;for(i=0,l=this.letter.length;l>i;i++)for(t=this.letter[i],A=0,n=t.length;n>A;A++)0==parseInt(t[A])&&this.blocks.push(new _({sprite:C.bunkerFullSmall,x:this.x+A*C.bunkerFullSmall.width,y:this.y+i*C.bunkerFullSmall.height}))},R={stars:[],starsLayer:2,k_star_number:10,init:function(){if(!("ontouchstart"in window)){this.stars=[];var e,t;for(e=0;e<this.starsLayer;e++)for(this.stars.push([]),t=0;t<this.k_star_number;t++)this.stars[e].push([Math.random()*o.width,Math.random()*o.height,Math.random()*(2*e+3),Math.random()/2,2*e+3,2*e+3-2])}},drawStars:function(){var e,t,i,n,A,s,r,l,a;for(l=0,nl=this.stars.length;nl>l;l++)for(a=0,il=this.stars[l].length;il>a;a++)e=this.stars[l][a],t=e[0],i=e[1],n=e[2],A=e[3],s=e[4],r=e[5],h.fillStyle="rgba(255, 255, 255, "+A+")",h.beginPath(),h.arc(t,i,n,0,2*Math.PI,!0),h.closePath(),h.fill(),0>t-n?(e[0]=o.width-n,e[2]=Math.random()*s,e[1]=Math.random()*o.height,e[3]=Math.random()/2):e[0]-=r}},M={flyingSaucer:null,alienBullet:null,flyingSaucerTimer:null,arrAliens:null,alienBorderCollision:null,alienBulletSpeed:10,nAlienRows:5,nAliensByRow:11,alienSquareWidth:60,alienSquareHeight:40,alienSpeedX:10,alienSpeedY:40,alienInitialY:180,flyingSaucerInitialY:120,flyingSaucerSpeed:4,init:function(){this.alienBorderCollision=!0,this.flyingSaucer=null,this.flyingSaucerTimer=(new Date).getTime(),this.alienBullet=null,this.arrAliens=[],this.alienSpeedX=10;for(var e,t,i=0;i<this.nAlienRows;i++){0==i&&(e=C.alien_1,t=30),i>0&&3>i&&(e=C.alien_2,t=20),i>2&&5>i&&(e=C.alien_3,t=10);for(var n=0;n<this.nAliensByRow;n++)this.arrAliens.push(new I({sprite:e,x:n*this.alienSquareWidth+(this.alienSquareWidth-e.width)/2,y:i*this.alienSquareHeight+this.alienInitialY,points:t}))}},updateAliens:function(){f++,f>3&&(f=0),v[f].play();for(var e,t={x:0,y:0,tile:1},i=this.alienSpeedX,n=0,A=0;A<this.arrAliens.length;A++)if(e=this.arrAliens[A],"striked"!=e.state){if(e.touchBorder()&&!this.alienBorderCollision){this.alienBorderCollision=!this.alienBorderCollision,i=0,n=this.alienSpeedY,this.alienSpeedX*=-1;break}e.y+e.sprite.height>=N.cannon.y&&(u=!0)}else this.arrAliens.splice(A,1),A=0;return 0!=i&&(this.alienBorderCollision=!this.alienBorderCollision),t.x=i,t.y=n,t},drawAlienShips:function(e){for(var t,i=0;i<this.arrAliens.length;i++)t=this.arrAliens[i],"striked"==t.state&&t.setSprite(C.alienExplosion),t.x+=e.x,t.y+=e.y,t.tileId+=e.tile,t.tileId>=t.sprite.tiles.length&&(t.tileId=0),h.drawImage(a,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width,t.sprite.height);0==this.arrAliens.length&&(g=Math.floor(.8*g),M.init())},updateFlyingSaucer:function(){return this.flyingSaucer&&"striked"==this.flyingSaucer.state},drawFlyingSaucer:function(e){var t=(new Date).getTime();this.flyingSaucer?("striked"==this.flyingSaucer.state&&(this.flyingSaucer.sprite=C.saucerExplosion),this.flyingSaucer.x<=-C.flyingSaucer.width||e?(this.flyingSaucer=null,this.flyingSaucerTimer=t):(k.play(),this.flyingSaucer.x-=this.flyingSaucerSpeed,h.drawImage(a,this.flyingSaucer.sprite.tiles[0].x,this.flyingSaucer.sprite.tiles[0].y,this.flyingSaucer.sprite.width,this.flyingSaucer.sprite.height,this.flyingSaucer.x,this.flyingSaucer.y,this.flyingSaucer.sprite.width,this.flyingSaucer.sprite.height))):t-this.flyingSaucerTimer>=1e4&&(this.flyingSaucer=new L({sprite:C.flyingSaucer,x:o.width,y:this.flyingSaucerInitialY,points:100}))},drawAliens:function(){var e,t={x:0,y:0,tile:0};d==g?(t=this.updateAliens(),e=this.updateFlyingSaucer(),d=0):d++,this.drawAlienShips(t),this.drawFlyingSaucer(e)},drawAlienBullet:function(){if(this.alienBullet){var e=!0;if(this.alienBullet.y+=this.alienBulletSpeed,this.alienBullet.y>=o.height&&(e=!1),e&&!w&&this.alienBullet.collide(N.cannon)&&(w=!0,m=r(),S.play(),z.nLives--,0==z.nLives&&N.cannon.tileId++,e=!1),e)for(var t,i,n=0,A=q.arrBunker.length;A>n;n++){t=q.arrBunker[n];for(var s=0,l=t.blocks.length;l>s;s++)if(i=t.blocks[s],this.alienBullet.collide(i)){i.tileId++,i.tileId>=i.sprite.tiles.length&&t.blocks.splice(s,1),e=!1;break}}if(e&&this.alienBullet.y+this.alienBullet.sprite.height>=z.lineY){var c=z.lineInterrupts.join();c.indexOf(this.alienBullet.x.toString())<0&&z.lineInterrupts.push(this.alienBullet.x)}e?h.drawImage(a,this.alienBullet.sprite.tiles[0].x,this.alienBullet.sprite.tiles[0].y,this.alienBullet.sprite.width,this.alienBullet.sprite.height,this.alienBullet.x,this.alienBullet.y,this.alienBullet.sprite.width,this.alienBullet.sprite.height):this.alienBullet=null}else{var d=Math.floor((this.arrAliens.length+1)*Math.random());this.arrAliens[d]&&(this.alienBullet=new E({sprite:C.alienBullet,x:this.arrAliens[d].x+this.arrAliens[d].sprite.width/2,y:this.arrAliens[d].y}))}}},N={cannon:null,cannonBullet:null,moveCannon:null,cannonFire:null,cannonSpeed:8,cannonBulletSpeed:10,score:0,init:function(){this.moveCannon="N",this.cannonFire=!1,this.cannonBullet=null,this.score=0,this.cannon=new I({sprite:C.cannon,x:o.width/2-C.cannon.width/2,y:o.height-55-C.cannon.height})},updateScore:function(e){this.score+=e},drawCannon:function(){if(!u)switch(this.moveCannon){case"L":this.cannon.x>=0&&(this.cannon.x+=-this.cannonSpeed);break;case"R":this.cannon.x<=o.width-this.cannon.sprite.width&&(this.cannon.x+=this.cannonSpeed);break;default:this.cannon.x+=0}this.cannon.y=o.height-55-C.cannon.height,u||w?(h.drawImage(a,this.cannon.sprite.tiles[1].x,this.cannon.sprite.tiles[1].y,this.cannon.sprite.width,this.cannon.sprite.height,this.cannon.x,this.cannon.y,this.cannon.sprite.width,this.cannon.sprite.height),w&&!u&&r()-m>1&&(w=!1)):h.drawImage(a,this.cannon.sprite.tiles[0].x,this.cannon.sprite.tiles[0].y,this.cannon.sprite.width,this.cannon.sprite.height,this.cannon.x,this.cannon.y,this.cannon.sprite.width,this.cannon.sprite.height)},drawCannonBullet:function(){if(this.cannonBullet){var e=!0;if(this.cannonBullet.y-=this.cannonBulletSpeed,this.cannonBullet.y<=0&&(e=!1),e&&M.alienBullet&&this.cannonBullet.collide(M.alienBullet)&&(M.alienBullet=null,e=!1),e&&M.flyingSaucer&&this.cannonBullet.collide(M.flyingSaucer)&&(T.play(),M.flyingSaucer.setState("striked"),this.updateScore(M.flyingSaucer.points),e=!1),e)for(var t,i=0;i<M.arrAliens.length;i++)if(t=M.arrAliens[i],this.cannonBullet.collide(t)){T.play(),t.setState("striked"),this.updateScore(t.points),e=!1;break}if(e)for(var n,A,i=0,s=q.arrBunker.length;s>i;i++){n=q.arrBunker[i];for(var r=0,l=n.blocks.length;l>r;r++)if(A=n.blocks[r],this.cannonBullet.collide(A)){A.tileId++,A.tileId>=A.sprite.tiles.length&&n.blocks.splice(r,1),e=!1;break}}if(e)for(var n,A,i=0,s=O.arrAdv.length;s>i;i++){n=O.arrAdv[i];for(var r=0,l=n.blocks.length;l>r;r++)if(A=n.blocks[r],this.cannonBullet.collide(A)){A.tileId++,A.tileId>=A.sprite.tiles.length&&n.blocks.splice(r,1),e=!1;break}}e?h.drawImage(a,this.cannonBullet.sprite.tiles[0].x,this.cannonBullet.sprite.tiles[0].y,this.cannonBullet.sprite.width,this.cannonBullet.sprite.height,this.cannonBullet.x,this.cannonBullet.y,this.cannonBullet.sprite.width,this.cannonBullet.sprite.height):this.cannonBullet=null}else this.cannonFire&&(u||w||(B.play(),this.cannonBullet=new E({sprite:C.cannonBullet,x:this.cannon.x+this.cannon.sprite.width/2-C.cannonBullet.width/2,y:this.cannon.y})))}},O={arrAdv:[],distance:0,advFrameCounter:0,adv_letters:[[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1],[1,0,0,0,1,1,1],[1,1,0,1,1,1,1],[1,1,0,1,1,1,1],[1,1,0,1,1,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]],[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,1,1,1,1,1],[1,0,0,0,0,1,1],[1,0,1,1,1,1,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],[[0,0,0,0,0,0,0],[0,1,0,0,0,1,0],[0,1,1,0,0,1,0],[0,1,0,1,0,1,0],[0,1,0,0,1,1,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]]],moveX:15,moveY:5,marginTop:-126,updateAdvFrameCounter:21,shakeAdv:150,init:function(){var e,t,i=this.adv_letters.length;this.arrAdv=[],this.moveX=15,this.moveY=5,this.advFrameCounter=0,this.updateAdvFrameCounter=21,O.shakeAdv=150;for(var n=0;i>n;n++)e=o.width/2-(1*C.bunkerFullSmall.width*7*i+this.distance*i)/2+n*(1*C.bunkerFullSmall.width*7+this.distance),t=O.marginTop,this.arrAdv.push(new Y({x:e,y:t,letter:this.adv_letters[n]}))},updateAdv:function(){for(var e,t,i,n,A=0;A<this.arrAdv.length;A++)for(e=this.arrAdv[A],e.y<40?e.y+=O.moveY:(O.moveY=0,O.updateAdvFrameCounter=5,0==O.shakeAdv--&&(O.moveX=0,O.updateAdvFrameCounter=33,S.play())),i=0,n=e.blocks.length;n>i;i++)t=e.blocks[i],t.x+=O.moveX,t.y+=O.moveY;O.moveX*=-1},drawAdv:function(){var e,t,i,n,A;for(n=0,b=this.arrAdv.length;b>n;n++)for(e=this.arrAdv[n],A=0,i=e.blocks.length;i>A;A++)t=e.blocks[A],h.drawImage(a,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width*e.scale,t.sprite.height*e.scale)},advLoop:function(){O.advFrameCounter==O.updateAdvFrameCounter?(O.updateAdv(),O.advFrameCounter=0):O.advFrameCounter++,this.drawAdv()}},q={arrBunker:[],nBunkers:4,init:function(){var e,t;this.arrBunker=[];for(var i=0;i<this.nBunkers;i++)e=o.width/(2*this.nBunkers)-4*C.bunkerFull.width/2+i*(o.width/this.nBunkers),t=o.height-180,this.arrBunker.push(new D({x:e,y:t}))},drawBunkers:function(){for(var e,t,i=0,n=this.arrBunker.length;n>i;i++){e=this.arrBunker[i];for(var A=0,s=e.blocks.length;s>A;A++)t=e.blocks[A],h.drawImage(a,t.sprite.tiles[t.tileId].x,t.sprite.tiles[t.tileId].y,t.sprite.width,t.sprite.height,t.x,t.y,t.sprite.width,t.sprite.height)}}},z={nLives:3,lineY:0,lineHeight:5,lineInterrupts:[],lineImageData:null,init:function(){this.nLives=3,this.lineInterrupts=[],this.lineImageData=null,this.lineY=o.height-50;new G.textArea({cls:"field livesField",childs:[G.writeText({cls:"text livesText",id:"livesPlayer1",text:this.nLives})],appendTo:x,left:"0px",bottom:"0px"})},sortInterrupts:function(e,t){return e-t},drawLine:function(){h.fillStyle="rgba(0,255,0,255)";var e=0,t=o.width;z.lineInterrupts.sort(this.sortInterrupts);for(var i=0;i<this.lineInterrupts.length;i++)t=this.lineInterrupts[i]-e,h.fillRect(e,this.lineY,t,this.lineHeight),e=this.lineInterrupts[i]+C.alienBullet.width;t=o.width-e,h.fillRect(e,this.lineY,t,this.lineHeight)},drawLives:function(){this.drawLine();for(var e,t,i=0;i<this.nLives;i++)t=o.height-C.cannon.height-7,e=C.cannon.width+1.5*i*C.cannon.width,c=new I({sprite:C.cannon,x:o.width/2-C.cannon.width/2,y:o.height-C.cannon.height}),h.drawImage(a,C.cannon.tiles[0].x,C.cannon.tiles[0].y,C.cannon.width,C.cannon.height,e,t,C.cannon.width,C.cannon.height);u||G.updateText("#livesPlayer1",this.nLives)}},G={textArea:function(e){if(this.div=document.createElement("div"),e.id&&(this.div.id=e.id),this.div.className=e.cls,this.childs=e.childs,this.appendTo=e.appendTo,e.width&&(this.div.style.width=e.width+"px"),this.appendTo.appendChild(this.div),this.childs)for(var t=0,i=this.childs.length;i>t;t++)this.div.appendChild(this.childs[t]);return this.set=function(e){var t,i,n,A;if(e.position)switch(e.position){case"centerBottom":t=o.width/2-this.div.offsetWidth/2+"px",A="0px";break;case"centerHV":t=o.width/2-this.div.offsetWidth/2+"px",i=o.height/2-this.div.offsetHeight/2+"px";break;case"centerH":t=o.width/2-this.div.offsetWidth/2+"px"}e.left&&(t=e.left),e.top&&(i=e.top),e.bottom&&(A=e.bottom),e.right&&(n=e.right),this.div.style.left=t,this.div.style.top=i,this.div.style.bottom=A,this.div.style.right=n},this.set(e),this},removeTextArea:function(e){x.removeChild(document.querySelector("#"+e))},writeText:function(e){var t=document.createElement("p");return t.className=e.cls,e.id&&(t.id=e.id),e.text&&t.appendChild(document.createTextNode(e.text)),e.innerhtml&&(t.innerHTML=e.innerhtml),e.onclick&&(t.onclick=e.onclick),t},writeAnything:function(e){if(!e.type)return!1;var t=document.createElement(e.type);if(e.cls&&(t.className=e.cls),e.attributes&&e.attributes.length)for(var i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i][0],e.attributes[i][1]);return e.id&&(t.id=e.id),e.text&&t.appendChild(document.createTextNode(e.text)),e.innerhtml&&(t.innerHTML=e.innerhtml),e.onclick&&(t.onclick=e.onclick),t},typewrite:function(e){for(var t,i,n=2,A=document.querySelectorAll(e),s=0;s<A.length;s++){t=A[s],t.className+=" typewrite ",i=t.textContent.length;var r=document.documentElement.appendChild(document.createElement("style")),l=t.id+"_typing {from {width: 0} to {width: "+i+"em}}";CSSRule.WEBKIT_KEYFRAMES_RULE?r.sheet.insertRule("@-webkit-keyframes "+l,0):CSSRule.MOZ_KEYFRAMES_RULE?r.sheet.insertRule("@-moz-keyframes "+l,0):CSSRule.KEYFRAMES_RULE&&r.sheet.insertRule("@keyframes "+l,0),l="{width: auto;}",r.sheet.insertRule("#"+t.id+".end"+l,0),t.style.animation=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.style["-webkit-animation"]=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.style.MozAnimation=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.style["-ms-animation"]=t.id+"_typing "+n+"s steps("+i+", end) "+s*n+"s",t.className+=" startTypewrite ",t.removeEventListener("animationend",this.typewrite_cb,!1),t.removeEventListener("webkitAnimationEnd",this.typewrite_cb,!1),t.addEventListener("animationend",this.typewrite_cb,!1),t.addEventListener("webkitAnimationEnd",this.typewrite_cb,!1)}return n*A.length},typewrite_cb:function(e){e.target.className+=" end "},changeTextColor:function(e,t){var i,n=s(e);if(!t){var A="0123456789ABCDEF";for(t="#",i=0;3>i;i++)t+=A.substr(Math.random()*A.length,1)}n&&(n.style.color=t)},updateText:function(e,t,i){var n=s(e);n.innerHTML=null==i?t:G.pad(t,5,"0","L")},removeText:function(e){var t=s("#"+e);console.debug(t),t&&t.parentNode.removeChild(t)},pad:function(e,t,i,n){var A="";for(e=e.toString();A.length<t-e.length;)A+=i;switch(n){case"L":e=A+e;break;case"R":e+=A}return e}},W={left:37,right:39,fire:32},H=function(e){e||(e=window.event),A(e.keyCode,e.type)},P=function(){h.clearRect(0,0,o.width,o.height),R.drawStars(),N.drawCannon(),O.advLoop(),M.drawAliens(),q.drawBunkers(),N.drawCannonBullet(),M.drawAlienBullet(),G.updateText("#scorePlayer1",N.score,!0),z.drawLives(),u&&it.gameOver(),0==z.nLives&&(u=!0)},X=function(){o=document.createElement("canvas"),o.tabIndex=0,h=o.getContext("2d"),x.appendChild(o)},j=function(){o.width=x.offsetWidth,o.height=x.offsetHeight,h.fillRect(0,0,o.width,o.height)},Q=function(e){if(!e)var e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),it.game()},K=function(e){if(!e)var e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();var t=s("#nameInput").value,i="",n=N.score;qwest.post("assets/php/si_call.php",{action:"saveScore",name:t,email:i,score:n}).success(function(){it.scoreSubmitted()}).error(function(e){alert("Error: "+e)})},V={init:function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),A=document.createElement("div"),s=document.createElement("div");mobile_shot_right=document.createElement("div"),mobile_shot_right_txt=document.createElement("div"),x.appendChild(e),x.appendChild(t),x.appendChild(i),x.appendChild(n),x.appendChild(A),x.appendChild(s),x.appendChild(mobile_shot_right),x.appendChild(mobile_shot_right_txt),e.className="mobile-button mobile-left",t.className="mobile-button mobile-left mobile-text",t.id="move-left",t.appendChild(document.createTextNode("<")),i.className="mobile-button mobile-right",n.className="mobile-button mobile-right mobile-text",n.id="move-right",n.appendChild(document.createTextNode(">")),A.className="mobile-button mobile-shot-left",s.className="mobile-button mobile-text mobile-shot-text-left",s.id="shot-L",s.appendChild(document.createTextNode("shot")),mobile_shot_right.className="mobile-button mobile-shot-right",mobile_shot_right_txt.className="mobile-button mobile-text mobile-shot-text-right",mobile_shot_right_txt.id="shot-R",mobile_shot_right_txt.appendChild(document.createTextNode("shot")),window.removeEventListener("touchstart",V.startTouch,!0),window.removeEventListener("touchend",V.stopTouch,!0),window.addEventListener("touchstart",V.startTouch,!0),window.addEventListener("touchend",V.stopTouch,!0)},startTouch:function(e){e||(e=window.event);var t=e.target.id;"right"==t||"move-right"==t?N.moveCannon="R":"left"==t||"move-left"==t?N.moveCannon="L":("fire"==t||"shot-L"==t||"shot-R"==t)&&(N.cannonFire=!0)},stopTouch:function(){N.moveCannon="N",N.cannonFire=!1}},Z=function(){tt(),a=new Image,a.onload=function(){X(),j(),d=0,u=!1,R.init(),z.init(),N.init(),M.init(),q.init(),O.init();var e=(new G.textArea({cls:"field scoreField",childs:[G.writeText({innerhtml:'<span class="text scoreText">score</span> <span class="text scoreText" id="scorePlayer1">00000</span>'})],appendTo:x,left:"0px",top:"0px"}),x);"ontouchstart"in window&&V.init(),function t(){P(),p=requestAnimationFrame(t,e)}()},a.src=F},J=function(){tt(),X(),j(),R.init();var e=y?"best score: "+y.name+" - "+y.score:"",t=new G.textArea({cls:"field",childs:[G.writeText({id:"play",cls:"text clickText menuText",innerhtml:"play",onclick:Q}),G.writeText({id:"AdvInvadersText",cls:"text",text:"space invaders"}),G.writeText({id:"bestScore",cls:"text clickText bestScore",text:e})],appendTo:x,width:o.width,position:"centerH",top:"20%"});t=new G.textArea({cls:"field scoreAdvanceTableField",childs:[G.writeText({cls:"text scoreAdvanceText",text:"*score advance table*"}),G.writeText({innerhtml:"<ul id='scoreAdvanceTable'><li><span><span id='span_score_adv'></span></span><p id='score_adv' class='text scoreAdvanceText'>= ? mystery</p></li><li class='li-right'><span><span id='span_score_mystery'></span></span><p id='score_mystery' class='text scoreAdvanceText'>= ? mystery</p></li><li class='li-right'><span><span id='span_score_30'></span></span><p id='score_30' class='text scoreAdvanceText'>= 30 points</p></li><li class='li-right'><span><span id='span_score_20'></span></span><p id='score_20' class='text scoreAdvanceText'>= 20 points</p></li><li class='li-right'><span><span id='span_score_10'></span></span><p id='score_10' class='text scoreAdvanceText'>= 10 points</p></li></ul>"})],appendTo:x,width:450,position:"centerH",top:"50%"}),t=new G.textArea({cls:"field",childs:[G.writeText({id:"instructionsLink",cls:"text clickText smallText",text:"instructions",onclick:it.instructions})],appendTo:x,width:400,position:"centerBottom"}),s("#span_score_adv").style.background="url('"+F+"') -4px -396px no-repeat",s("#span_score_mystery").style.background="url('"+F+"') -4px -122px no-repeat",s("#span_score_30").style.background="url('"+F+"') -4px -4px no-repeat",s("#span_score_20").style.background="url('"+F+"') -4px -40px no-repeat",s("#span_score_10").style.background="url('"+F+"') -4px -76px no-repeat";var i=(G.typewrite("#score_adv, #score_10, #score_20, #score_30, #score_mystery"),x);!function n(){h.clearRect(0,0,o.width,o.height),R.drawStars(),G.changeTextColor("#play"),p=requestAnimationFrame(n,i)}()},U=function(){new G.textArea({id:"divInstructions",cls:"field instructionsFieldFrame",childs:[G.writeText({cls:"text instructionsText",innerhtml:"<ol><li>press 'play' to start</li><li>left/right keys to move</li><li>'spacebar' to shot</li></ol>"}),G.writeText({cls:"text clickText menuText",text:"close",onclick:function(){G.removeTextArea("divInstructions")}})],appendTo:x,position:"centerHV"})},$=function(){new G.textArea({id:"divScoreSubmitted",cls:"field submittedFieldFrame",childs:[G.writeText({cls:"text submittedText",text:"Score saved!"}),G.writeText({cls:"text clickText menuText",text:"close",onclick:function(){G.removeTextArea("divScoreSubmitted"),G.removeText("nameLabel"),G.removeText("nameInput"),G.removeText("scoreSubmitButton")}})],appendTo:x,position:"centerHV"})},et=function(){if(!s("#divGameOver")){var e=[G.writeText({id:"gameOver",cls:"text menuHeaderText",text:"game over"}),G.writeText({id:"playAgain",cls:"text clickText menuText",text:"play again",onclick:Q})];y&&N.score>y.score&&(e.push(G.writeAnything({type:"span",id:"nameLabel",cls:"labelSpan",innerhtml:"Name: "})),e.push(G.writeAnything({type:"input",id:"nameInput",cls:"inputBox",attributes:[["type","text"]]})),e.push(G.writeText({id:"scoreSubmitButton",cls:"text clickText menuText",text:"save your score",onclick:K}))),e.push(G.writeText({id:"tweetScore",cls:"text clickText",innerhtml:"<a target='blank' href='https://twitter.com/intent/tweet?original_referer=http://matteopiazza.org&text=Play%20Advertise%20Invaders%20on%20matteopiazza.org!%20My%20score:%20"+N.score+"!&tw_p=tweetbutton'>tweet your score</a>"}));{new G.textArea({id:"divGameOver",cls:"field menuFieldFrame",childs:e,appendTo:x,position:"centerHV"})}}},tt=function(){for(;x.hasChildNodes();)x.removeChild(x.lastChild)},it={intro:function(){cancelAnimationFrame(p),J()},instructions:function(){U()},game:function(){cancelAnimationFrame(p),Z()},gameOver:function(){cancelAnimationFrame(p),et()},scoreSubmitted:function(){$()}},nt=function(){it.intro()};window.addEventListener("keydown",function(e){e||(e=window.event),[32].indexOf(e.keyCode)>-1&&e.preventDefault()},!1),window.removeEventListener("keydown",H,!0),window.removeEventListener("keyup",H,!0),window.removeEventListener("resize",j,!0),window.addEventListener("keydown",H,!0),window.addEventListener("keyup",H,!0),window.addEventListener("resize",j,!0),JYI.config({inputHandler:i,wsAddress:"ws://localhost:8000"}),nt()};window.WIinit=function(){var t=null;qwest.post("assets/php/si_call.php",{action:"getScore"}).success(function(e){e.data&&e.data.length>0&&(t=e.data[0])}).error(function(e){alert("Error retrieving best score: "+e)}).complete(function(){e("game",t)})}}();